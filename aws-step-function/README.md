# aws-step-function

This directory contains the AWS step function definition used by the smart-zoneminder project.

The step function orchestrates calls to the AWS Lambda Functions required to process ZoneMinder alarm frames.

Based on and inspired by [smart-security-camera](https://github.com/markwest1972/smart-security-camera).

## Contents

* **step-smart-zoneminder.json** - Process definition for step function.
* **step-smart-zoneminder.png** - Visual representation of step function generated by AWS.

## How to use

### IAM Role

Normally AWS will generate a role for you, but if it doesn't then you can use the [AWS IAM Console](https://aws.amazon.com/console/) create an IAM Role containing the "AWSLambdaRole" permission. This will allow your state machine to call AWS Lambda Functions.

### Setting up the Step Function (aka State Machine)

This is done from the [Step Function Console](https://aws.amazon.com/step-functions/).  Note that Amazon uses 'State Machine' and 'Step Function' interchangeably.

Creating the step function is trivial - you basically copy the contents of the JSON file into the wizard.  The following tips might save your some time:

1. Define  the AWS Lambda Functions needed for ZoneMinder alarm frame processing  before starting with the step function.
2. Make sure that you note the arn of your Step Function.  This will be used in the *s3-trigger-image-processing* function.
3. Make sure the correct arn values are used in the Resource values.  The arn value for each Lambda Function is visible in the top right hand corner of the screen when viewing a Lambda Function definition.
4. Make sure also that the region is correctly set.  This needs to point to the region where your Lambda Functions are uploaded.
